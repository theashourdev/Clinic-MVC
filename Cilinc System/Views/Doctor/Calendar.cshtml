@* @{
    ViewData["Title"] = "Doctor Calendar";
}

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />

<div class="container mt-4">
    <h2>Doctor Calendar</h2>

    <div class="mb-3">
        <label class="form-label">Select Doctor</label>
        <select id="DoctorId" class="form-select">
            <option value="">-- Select Doctor --</option>
            @foreach (var doc in ViewBag.Doctors as SelectList)
            {
                <option value="@doc.Value">@doc.Text</option>
            }
        </select>
    </div>

    <div id="calendar" class="mt-4"></div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

    <script>
        var calendar;

        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');

            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',    
                height: 650,
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: []
            });

            calendar.render();
        });

        $('#DoctorId').change(function () {
            var doctorId = $(this).val();
            if (!doctorId) {
                calendar.removeAllEvents();
                return;
            }

            $.getJSON('@Url.Action("GetDoctorAppointments", "Appointment")', { doctorId: doctorId }, function (data) {
                calendar.removeAllEvents();

                data.forEach(function (evt) {
                    calendar.addEvent({
                        title: evt.title,            
                        start: evt.start,            
                        end: evt.end,                
                        color: evt.status === 'Booked' ? 'green' :
                               evt.status === 'Completed' ? 'blue' :
                               evt.status === 'Cancelled' ? 'red' : 'gray'
                    });
                });
            });
        });
    </script>
}
 *@

@* @{
    ViewData["Title"] = "Doctor Calendar";
}

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />

<div class="container mt-4">
    <h2>Doctor Calendar</h2>

    <div class="mb-3">
        <label class="form-label">Select Doctor</label>
        <select id="DoctorIds" class="form-select" multiple>
            @foreach (var doc in ViewBag.Doctors as SelectList)
            {
                <option value="@doc.Value">@doc.Text</option>
            }
        </select>

    </div>

    <div id="calendar" class="mt-4"></div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

    <script>
        var calendar;

        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');

            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                height: 650,
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: [],
                eventClick: function(info) {
                    var appointmentId = info.event.id;
                    if (appointmentId) {
                        // Redirect to Appointment Details page
                        window.location.href = '/Appointment/Details/' + appointmentId;
                    }
                }
            });

            calendar.render();
        });

        $('#DoctorId').change(function () {
            var doctorId = $(this).val();
            if (!doctorId) {
                calendar.removeAllEvents();
                return;
            }

            $.getJSON('@Url.Action("GetDoctorAppointments", "Appointment")', { doctorId: doctorId }, function (data) {
                calendar.removeAllEvents();

                data.forEach(function (evt) {
                    calendar.addEvent({
                        id: evt.id,                 
                        title: evt.title,
                        start: evt.start,
                        end: evt.end,
                        color: evt.status === 'Booked' ? 'green' :
                               evt.status === 'Completed' ? 'blue' :
                               evt.status === 'Cancelled' ? 'red' : 'gray'
                    });
                });
            });
        });
    </script>
}
 *@

@{
    ViewData["Title"] = "Doctor Calendar";
}

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">

<div class="container mt-4">
    <h2>Doctor Calendar</h2>

    <div class="mb-3">
        <label class="form-label">Select Doctor(s)</label>
        <select id="DoctorIds" class="selectpicker form-select" multiple data-live-search="true" title="Select Doctor(s)">
            @foreach (var doc in ViewBag.Doctors as SelectList)
            {
                <option value="@doc.Value">@doc.Text</option>
            }
        </select>
    </div>

    <div id="calendar" class="mt-4"></div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>

    <script>
        var calendar;

        document.addEventListener('DOMContentLoaded', function () {
            // Initialize Bootstrap Select
            $('.selectpicker').selectpicker();

            var calendarEl = document.getElementById('calendar');

            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                height: 650,
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: [],
                eventClick: function(info) {
                    var appointmentId = info.event.id;
                    if (appointmentId) {
                        window.location.href = '/Appointment/Details/' + appointmentId;
                    }
                }
            });

            calendar.render();

            // Load all appointments initially
            loadAppointments();
        });

        function loadAppointments() {
            var doctorIds = ($('#DoctorIds').val() || []).map(Number);

            // قم بإرسال كل id كـ doctorIds[index]=value
            var params = {};
            doctorIds.forEach((id, idx) => params[`doctorIds[${idx}]`] = id);

            $.getJSON('@Url.Action("GetDoctorAppointments", "Appointment")', params, function(data) {
                calendar.removeAllEvents();
                data.forEach(function(evt) {
                    calendar.addEvent({
                        id: evt.id,
                        title: evt.title,
                        start: evt.start,
                        end: evt.end,
                        color: evt.status === 'Booked' ? 'green' :
                               evt.status === 'Completed' ? 'blue' :
                               evt.status === 'Cancelled' ? 'red' : 'gray'
                    });
                });
            });
        }

        // Reload appointments whenever selection changes
        $('#DoctorIds').on('changed.bs.select', loadAppointments); // Bootstrap Select event
    </script>
}
