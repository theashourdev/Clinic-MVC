
@model IEnumerable<Cilinc_System.Models.Specialties>

@{
    ViewData["Title"] = "Specialties List";

    string GetShortDescription(string description, int maxLength = 100)
    {
        if (string.IsNullOrEmpty(description) || description.Length <= maxLength)
            return description;

        var cutIndex = description.LastIndexOf(' ', maxLength);
        if (cutIndex == -1) cutIndex = maxLength;

        return description.Substring(0, cutIndex) + "...";
    }
}


@if(Model.Any())
{
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold">📋 Specialties</h2>
        <a class="btn btn-primary" asp-action="Create">➕ Add New</a>
    </div>

    <div class="row">
        @foreach (var item in Model)
        {
            <div class="col-md-4 mb-4" id="card-@item.Id">
                <div class="card shadow-sm h-100" style="height: 360px;">
                    <img src="@(string.IsNullOrEmpty(item.ImagePath)
                                     ? Url.Content("~/images/specialty-form.png")
                                     : Url.Content(item.ImagePath))"
                     class="card-img-top"
                     alt="@item.Name"
                     style="height: 140px; object-fit: contain; padding: 10px;">
                <div class="card-body d-flex flex-column justify-content-between text-center p-2">
                        <div>
                            <h6 class="card-title fw-bold mb-1">@item.Name</h6>
                            <p class="card-text text-muted small">@GetShortDescription(item.Description)</p>
                        </div>
                        <div class="mt-2">

                            <button class="btn btn-sm btn-outline-primary me-2" onclick="showDetails(@item.Id)">
                                <i class="bi bi-eye"></i> Details
                            </button>

                            <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-outline-warning me-2">
                                <i class="bi bi-pencil-square"></i> Edit
                            </a>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteSpecialty(@item.Id)">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="text-center my-5">
        <h4 class="mb-4 text-muted">No spcialties found. Start by adding your first spcialty!</h4>
        <a asp-action="Create" class="btn btn-lg btn-success px-4">
            <i class="bi bi-person-plus"></i> Add Spcialty
        </a>
    </div>
}


<div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <button type="button" class="btn-close ms-auto mt-2 me-2" data-bs-dismiss="modal" aria-label="Close"></button>
            <div id="detailsContainer"></div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function showDetails(id) {
            $.get('/Specialties/Details/' + id, function (data) {
                $('#detailsContainer').html(data);
                $('#detailsModal').modal('show');
            });
        }

        function deleteSpecialty(id) {
            Swal.fire({
                title: 'Are you sure?',
                text: "This action cannot be undone!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.post('/Specialties/Delete', { id: id }, function (data) {
                        if (data.success) {
                            $('#card-' + id).remove();
                            Swal.fire('Deleted!', 'The specialty has been deleted.', 'success');
                        } else {
                            Swal.fire('Error!', data.message, 'error');
                        }
                    });
                }
            });
        }
    </script>
}